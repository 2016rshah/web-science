<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Module: pageManager</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Module: pageManager</h1>

    




<section>

<header>
    
</header>

<article>
    <div class="container-overview">
    
        
            <div class="description"><h1>Overview</h1>
<p>This module addresses several challenges for studying user engagement with web content.</p>
<ul>
<li><strong>Syncing Measurements and Interventions.</strong> A study that uses <code>WebScience</code> will
often involve multiple measurements or interventions on a webpage. The
<code>pageManager</code> module enables studies to sync these measurements and interventions
by assigning a random unique identifier to each webpage.</li>
<li><strong>Generating Page Lifecycle Events.</strong> Measurements and interventions are often
linked to specific events in the webpage lifecyle. The <code>pageManager</code> module
standardizes a set of webpage lifecycle events.</li>
<li><strong>Tracking User Attention.</strong> Measurements and interventions often depend on user
attention to web content. The <code>pageManager</code> module provides a standardized
attention model that incorporates tab switching, window switching, application
switching, locked screens, and user mouse and keyboard input.</li>
<li><strong>Generating Audio Events.</strong> This module provides events for webpage audio,
enabling measurements and interventions based on media playback.</li>
<li><strong>Bridging the Background and Content Script Environments.</strong> WebExtensions
includes two distinct execution environments: background scripts and content
scripts. These execution environments are, unfortunately, only loosely bound
together by tab IDs. As a result, there can be race conditions---the background
and content environments can have mismatched states, such that messages arrive
at the wrong webpage or are attributed to the wrong webpage. This module
provides provides page lifecycle, user attention, and audio events that are
bound to specific webpages.</li>
</ul>
<h1>Pages</h1>
<p>This module creates an abstraction over webpages as perceived by users (i.e., when
content loads with a new HTTP(S) URL in the browser bar or the page visibly reloads).
Note that the History API enables web content to modify the URL without loading a new
HTML document via HTTP(S) or creating a new Document object. This module treats
a URL change via the History API as equivalent to traditional webpage navigation,
because (by design) it appears identical to the user. Accounting for the History
API is important, because it is used on some exceptionally popular websites (e.g.,
YouTube).</p>
<h1>Page IDs</h1>
<p>Each page ID is 128-bit value, randomly generated with the Web Crypto API and
stored as a hexadecimal <code>String</code>. While this representation is less efficient than
a <code>Uint8Array</code> or similar, it is more convenient for development and debugging. The
page ID is available in the content script environment.</p>
<h1>Page Lifecycle</h1>
<p>Each webpage has the following lifecycle events, which fire in both the background
page and content script environments.</p>
<ul>
<li>Page Visit Start - The browser has started to load a webpage in a tab. This
event is fired early in context script execution (i.e., soon after
<code>document_start</code>). For a webpage with a new Document, the event is
timestamped with the time the <code>window</code> object was created (the time origin
from the High Resolution Time Level 2 API, in ms). For a webpage that does not
have a new Document (i.e., resulting from the History API), the event is
timestamped with the URL change in the WebNavigation API.</li>
<li>Page Visit Stop - The browser is unloading the webpage. Ordinarily this
event fires and is timestamped with the <code>window</code> unload event. When the page
changes via the History API, this event fires and is timestamped with the URL
change in the WebNavigation API.</li>
</ul>
<h1>Attention Tracking</h1>
<p>Attention to a page is defined as satisfying all of the following conditions.</p>
<ul>
<li>The tab is the active tab in its browser window.</li>
<li>The window containing the tab is the current browser window.</li>
<li>The current browser window has focus in the operating system.</li>
<li>The operating system is not displaying a lock screen or screen saver.</li>
<li>Optional: The user has provided mouse or keyboard input within a specified time
interval.</li>
</ul>
<p>In the content script environment, each page has an attention status, and an event
fires when that status changes. Attention update events are timestamped with events
from the WebExtensions <code>tabs</code>, <code>windows</code>, and <code>idle</code> APIs.</p>
<h1>Audio Events</h1>
<p>In the content script environment, each page has an audio status, and an event fires
when that status changes. Audio update events fire and are timestamped with events
from the WebExtensions <code>tabs</code> API.</p>
<h1>Event Ordering</h1>
<p>This module guarantees the ordering of page lifecycle, attention, and audio events.</p>
<ul>
<li>Page visit start and page visit stop only fire once for each page, in that order.</li>
<li>Page attention and audio update events will only occur between page visit start
and stop events.</li>
</ul>
<h1>Additional Implementation Notes</h1>
<p>This module depends on the <code>idle</code> API, which has a couple quirks in Firefox:</p>
<ul>
<li>There is a five-second interval when polling idle status from the operating
system.</li>
<li>Depending on the platform, the idle API reports either time since user input to
the browser or time since user input to the operating system.</li>
</ul>
<p>The polling interval coarsens the timing of page attention events related to idle state.
As long as the polling interval is relatively short in comparison to the idle threshold,
that should not be an issue.</p>
<p>The platform-specific meaning of idle state should also not be an issue. There is only a
difference between the two meanings of idle state when the user is providing input to
another application; if the user is providing input to the browser, or is not providing
input at all, the two meanings are identical. In the scenario where the user is providing
input to another application, the browser will lose focus in the operating system; this
module will detect that with the windows API and fire a page attention event (if needed).</p>
<p>Some implementation quirks to be aware of for future development on this module:</p>
<ul>
<li>Non-browser windows do not appear in the results of <code>windows.getAll()</code>, and calling
<code>windows.get()</code> on a non-browser window throws an error. Switching focus to a non-
browser window will, however, fire the <code>windows.onFocusChanged</code> event. The module
assumes that if <code>windows.onFocusChanged</code> fires with an unknown window, that window
is a non-browser window.</li>
<li>The module assumes that valid tab IDs and window IDs are always &gt;= 0.</li>
</ul>
<h1>Known Issues</h1>
<ul>
<li>The background script sends update messages to tabs regardless of whether they
are ordinary tabs or have the pageManager content script running, because the
background script does not track window types or tab content. The errors
generated by this issue are caught in <code>messaging.sendMessageToTab</code>, and the
issue should not cause any problems for studies.</li>
</ul>
<h1>Possible Improvements</h1>
<ul>
<li>Rebuild a page attention update event in the background page environment.</li>
<li>Rebuild the capability to fire events for pages that are already open when the module
loads.</li>
<li>Add logic to handle the situation where the content script execution environment crashes,
so the page visit stop message doesn't fire from the associated content script.</li>
<li>Add an event in the content script for detecting when content has lazily loaded into the
DOM after the various DOM loading events (e.g., on Twitter).</li>
</ul></div>
        

        


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="pageManager.js.html">pageManager.js</a>, <a href="pageManager.js.html#line1">line 1</a>
    </li></ul></dd>
    

    

    

    
</dl>


        
    
    </div>

    

    

    

    

    

    

    
        <h3 class="subsection-title">Members</h3>

        
            
<h4 class="name" id=".onPageVisitStart"><span class="type-signature">(static, constant) </span>onPageVisitStart<span class="type-signature"> :Events.Event.&lt;pageVisitStartListener, PageVisitStartListenerOptions></span></h4>




<div class="description">
    <p>An event that is fired when a page visit starts.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Events.Event.&lt;pageVisitStartListener, PageVisitStartListenerOptions></span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="pageManager.js.html">pageManager.js</a>, <a href="pageManager.js.html#line180">line 180</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
            
<h4 class="name" id=".onPageVisitStop"><span class="type-signature">(static, constant) </span>onPageVisitStop<span class="type-signature"> :Events.Event.&lt;pageVisitStopListener, PageVisitStartListenerOptions></span></h4>




<div class="description">
    <p>An event that is fired when a page visit starts.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Events.Event.&lt;pageVisitStopListener, PageVisitStartListenerOptions></span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="pageManager.js.html">pageManager.js</a>, <a href="pageManager.js.html#line227">line 227</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
    

    

    
        <h3 class="subsection-title">Type Definitions</h3>

        
                
<h4 class="name" id="~PageVisitStartDetails">PageVisitStartDetails</h4>




<div class="description">
    <p>Additional information about a page visit start event.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Object</span>


        </li>
    </ul>





    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>isHistoryChange</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            

            

            <td class="description last"><p>Whether the page visit was caused by a change via the History API.</p></td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="pageManager.js.html">pageManager.js</a>, <a href="pageManager.js.html#line148">line 148</a>
    </li></ul></dd>
    

    

    

    
</dl>






            
                

    

    
    <h4 class="name" id="~pageVisitStartListener"><span class="type-signature"></span>pageVisitStartListener<span class="signature">(details)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>A listener function for page visit start events.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>details</code></td>
            

            <td class="type">
            
                
<span class="param-type">PageVisitStartDetails</span>


            
            </td>

            

            

            <td class="description last"><p>Additional information about the page visit start event.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="pageManager.js.html">pageManager.js</a>, <a href="pageManager.js.html#line163">line 163</a>
    </li></ul></dd>
    

    

    

    
</dl>




















            
                
<h4 class="name" id="~PageVisitStartListenerOptions">PageVisitStartListenerOptions</h4>




<div class="description">
    <p>Additional information about a page visit start event listener function.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Object</span>


        </li>
    </ul>





    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>privateWindows</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            

            

            <td class="description last"><p>Whether to notify the listener function for events in private windows.</p></td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="pageManager.js.html">pageManager.js</a>, <a href="pageManager.js.html#line169">line 169</a>
    </li></ul></dd>
    

    

    

    
</dl>






            
                
<h4 class="name" id="~PageVisitStopDetails">PageVisitStopDetails</h4>




<div class="description">
    <p>Additional information about a page visit stop event.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Object</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="pageManager.js.html">pageManager.js</a>, <a href="pageManager.js.html#line198">line 198</a>
    </li></ul></dd>
    

    

    

    
</dl>






            
                

    

    
    <h4 class="name" id="~pageVisitStopListener"><span class="type-signature"></span>pageVisitStopListener<span class="signature">(details)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>A listener function for page visit stop events.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>details</code></td>
            

            <td class="type">
            
                
<span class="param-type">PageVisitStopDetails</span>


            
            </td>

            

            

            <td class="description last"><p>Additional information about the page visit stop event.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="pageManager.js.html">pageManager.js</a>, <a href="pageManager.js.html#line210">line 210</a>
    </li></ul></dd>
    

    

    

    
</dl>




















            
                
<h4 class="name" id="~PageVisitStopListenerOptions">PageVisitStopListenerOptions</h4>




<div class="description">
    <p>Additional information about a page visit start stop listener function.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Object</span>


        </li>
    </ul>





    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>privateWindows</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            

            

            <td class="description last"><p>Whether to notify the listener function for events in private windows.</p></td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="pageManager.js.html">pageManager.js</a>, <a href="pageManager.js.html#line216">line 216</a>
    </li></ul></dd>
    

    

    

    
</dl>






            
                
<h4 class="name" id="~WindowDetails">WindowDetails</h4>






    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Object</span>


        </li>
    </ul>





    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>activeTab</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            

            

            <td class="description last"><p>The ID of the active tab in the window,
or -1 if there is no active tab.</p></td>
        </tr>

    
    </tbody>
</table>




<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="pageManager.js.html">pageManager.js</a>, <a href="pageManager.js.html#line292">line 292</a>
    </li></ul></dd>
    

    

    

    
</dl>






            
    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="webScience.module_contentScripts.html">contentScripts</a></li><li><a href="webScience.module_dataAnalysis.html">dataAnalysis</a></li><li><a href="webScience.module_debugging.html">debugging</a></li><li><a href="webScience.module_events.html">events</a></li><li><a href="webScience.module_idle.html">idle</a></li><li><a href="webScience.module_linkExposure.html">linkExposure</a></li><li><a href="webScience.module_linkResolution.html">linkResolution</a></li><li><a href="webScience.module_matching.html">matching</a></li><li><a href="webScience.module_messaging.html">messaging</a></li><li><a href="webScience.module_pageClassification.html">pageClassification</a></li><li><a href="webScience.module_pageManager.html">pageManager</a></li><li><a href="webScience.module_pageNavigation.html">pageNavigation</a></li><li><a href="webScience.module_scheduling.html">scheduling</a></li><li><a href="webScience.module_socialMediaActivity.html">socialMediaActivity</a></li><li><a href="webScience.module_socialMediaLinkSharing.html">socialMediaLinkSharing</a></li><li><a href="webScience.module_storage.html">storage</a></li><li><a href="webScience.module_userSurvey.html">userSurvey</a></li></ul><h3>Classes</h3><ul><li><a href="webScience.module_events.Event.html">Event</a></li><li><a href="webScience.module_events.EventSingleton.html">EventSingleton</a></li><li><a href="webScience.module_events.EventWithoutOptions.html">EventWithoutOptions</a></li><li><a href="webScience.module_matching.MatchPatternSet.html">MatchPatternSet</a></li><li><a href="webScience.module_storage.Counter.html">Counter</a></li><li><a href="webScience.module_storage.IndexedStorage.html">IndexedStorage</a></li><li><a href="webScience.module_storage.KeyValueStorage.html">KeyValueStorage</a></li></ul><h3>Interfaces</h3><ul><li><a href="webScience.module_linkExposure-LinkExposureDetails.html">LinkExposureDetails</a></li><li><a href="webScience.module_pageNavigation-PageDataDetails.html">PageDataDetails</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Tue Apr 06 2021 12:42:55 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>